---
title: Java并发笔记4
date: 2018-07-17 11:30:18
tags: [Java,编程语言,读书笔记, Java并发编程实战]
categories: [编程语言]
---
### Java编发编程第三章 共享对象
#### 3.1.3 锁与可见性
- 64位数值(如long/double)在并发时会出现问题

#### 3.1.4 易变变量
- 加锁的意义不仅仅局限于互斥行为，还包括内存可见性。为了确保所有线程都能看到共享变量的最新值，所有执行读和写操作的线程都应该在同一个锁上同步。
- 当一个变量被声明为`volatile`时，编译器和运行时会注意到这是一个共享变量，并且对它的操作不应该与其他内存操作一起被重新排序。
- 从内存的角度，写入`volatile`变量就像是退出了同步块，而读取一个`volatile`变量就像进入了同步块。
- 不建议过度依赖`volatile`变量提供的可见性，这通常比使用锁更脆弱而且更难以理解。
- 只在能够简化代码实现和并发策略验证时使用`volatile`,*如果验证正确性时需要对可见性进行微妙推理时，就要避免使用`volatile`*。
- `volatile`的正确使用方法包括：1.保证自身可见性。2.保证他们指向对象的可见性。3.指示重要声明周期(初始化或者关闭)事件的发生。
- 调试提示: 对于服务器程序，无论是开发还是测试阶段启动JVM都一定要指定`-server`选项
##### 典型应用
使用`volatile`变量作为标志，只是循环的结束。
##### 最佳实践
当且仅当满足以下条件时，才应该使用`volatile`变量
1. 对变量的写入不依赖于变量的当前值，或者你能保证只有单个线程更新变量的值。
2. 该变量不会与其他变量一起纳入不可变性条件当中。
3. 在访问变量时不需要加锁。

#### 3.2 发布和逸出
